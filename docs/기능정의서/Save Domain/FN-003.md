FN-003: Duplicate Content Detection
- Purpose / Value – Prevent saving identical content multiple times
- Scope / Module – features/save/domain/services/duplicate_detector
- Primary Actor(s) – Background Processor, Save Handler
- Triggers – Before saving any new content
- Inputs –
  - URL (String)
  - Content hash (String)
  - Time window (Duration)
- Processing Logic –
  1. Generate content fingerprint
  2. Query existing content by URL
  3. Check within time window (24h)
  4. Compare content hashes
  5. Check cross-platform duplicates
  6. Calculate similarity score
  7. Return duplicate status
- Outputs –
  - Is duplicate (Boolean)
  - Existing content ID (String?)
  - Similarity score (Double)
- Business Rules & Constraints –
  - Exact URL match = duplicate
  - 24-hour duplicate window
  - 85% similarity threshold
  - Ignore query parameters for YouTube
- Error Handling & Edge Cases –
  - Hash generation fails → Use URL only
  - Database error → Allow save (fail-safe)
  - Cross-post detection → Link contents
- Data Model Touchpoints –
  - contents (READ)
  - content_hashes (READ)
- API Endpoints / Methods – Local processing
- Permissions / Security – User's content only
- Performance / SLA Notes – < 100ms check time
- UX References –
  - DuplicateWarningDialog
  - MergeOptionsSheet
- Dependencies – crypto: ^3.0.0
- Acceptance Criteria –
  - 99% accuracy for exact duplicates
  - No false positives
  - Fast performance
- Code Pointers –
  - lib/features/save/domain/services/duplicate_detector.dart
  - lib/core/utils/content_hasher.dart