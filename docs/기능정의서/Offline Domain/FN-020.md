FN-020: Offline Content Sync
- Purpose / Value – Seamlessly sync offline changes when connected
- Scope / Module – features/offline/services/sync_service
- Primary Actor(s) – System, Background Worker
- Triggers –
  - Network restored
  - App launch
  - Manual sync
  - Scheduled sync
- Inputs –
  - Offline changes (List<Change>)
  - Last sync time (DateTime)
  - Conflict strategy (ConflictStrategy)
- Processing Logic –
  1. Detect connection
  2. Gather local changes
  3. Check for conflicts
  4. Apply resolution strategy
  5. Upload changes
  6. Download updates
  7. Merge data
  8. Update sync status
- Outputs –
  - Sync result (SyncResult)
  - Conflicts resolved (List)
  - New content (List)
- Business Rules & Constraints –
  - Latest change wins
  - Max 1000 items/sync
  - Incremental sync only
  - 24h sync window
- Error Handling & Edge Cases –
  - Partial sync → Resume point
  - Conflict → User choice
  - API error → Retry queue
  - Data loss → Backup restore
- Data Model Touchpoints –
  - sync_queue (CRUD)
  - sync_metadata (UPDATE)
  - conflict_log (CREATE)
- API Endpoints / Methods –
  - POST /api/sync/upload
  - GET /api/sync/changes
- Permissions / Security –
  - Authenticated only
  - Encrypted transfer
- Performance / SLA Notes –
  - Delta sync only
  - Compress data
- UX References –
  - SyncStatusBar
  - ConflictDialog
  - SyncProgress
- Dependencies –
  - connectivity_plus: ^5.0.0
- Acceptance Criteria –
  - No data loss
  - Fast sync
  - Conflict handling
  - Offline-first
- Code Pointers –
  - lib/features/offline/services/sync_service.dart
  - lib/features/offline/models/sync_state.dart